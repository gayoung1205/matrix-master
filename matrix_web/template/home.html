{#{% extends 'base.html' %}#}
{#{% block content %}#}
{#{% load static %}#}
{#{% load filter_tags %}#}
{##}
{#<div class="container-fluid">#}
{#  <div class="row">#}
{#    <!-- Ï¢åÏ∏° Î©îÏù∏ ÏòÅÏó≠ -->#}
{#    <div class="col-10">#}
{#      {% if main %}#}
{#        {% for m in main %}#}
{#        <div class="card matrix-card main mb-3">#}
{#          <div class="card-body">#}
{#            <h5 class="card-title">{{ m.name }}</h5>#}
{#            <div class="row align-items-center">#}
{#              <div class="col-6">#}
{#                <div class="row">#}
{#                  {% for i in 1|range_tag:9 %}#}
{#                  <div class="col-3">#}
{#                    <div class="control">#}
{#                      <img src="{% static 'img/icon1.png' %}" />#}
{#                      <p>{{ connect_list|list_index:i }}</p>#}
{#                    </div>#}
{#                    <div class="form-group">#}
{#                      <select class="form-control form-control-sm" name="input_select" id="input_select-0{{ i }}-{{ m.id }}">#}
{#                        {% for j in 1|range_tag:17 %}#}
{#                        <option {% if m|option_selected:i == j %}selected{% endif %} value="0{{ j }}">{{ connect_list|list_index:j }}</option>#}
{#                        {% endfor %}#}
{#                      </select>#}
{#                    </div>#}
{#                  </div>#}
{#                  {% endfor %}#}
{#                </div>#}
{#              </div>#}
{#              <div class="col-6">#}
{#                <div class="row">#}
{#                  {% for i in 9|range_tag:17 %}#}
{#                  <div class="col-3">#}
{#                    <div class="control">#}
{#                      <img src="{% static 'img/icon1.png' %}" />#}
{#                      <p>{{ connect_list|list_index:i }}</p>#}
{#                    </div>#}
{#                    <div class="form-group">#}
{#                      <select class="form-control form-control-sm" name="input_select" id="input_select-0{{ i }}-{{ m.id }}" {% if i > 6 %}disabled{% endif %}>#}
{#                        {% for j in 1|range_tag:17 %}#}
{#                        <option {% if m|option_selected:i == j %}selected{% endif %} value="0{{ j }}">{{ connect_list|list_index:j }}</option>#}
{#                        {% endfor %}#}
{#                      </select>#}
{#                    </div>#}
{#                  </div>#}
{#                  {% endfor %}#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#          </div>#}
{#        </div>#}
{##}
{#        <!-- ‚úÖ ÌÑ∞Ïπò PC Ïπ¥Îìú -->#}
{#        <div class="card matrix-card main mb-3 pcSection">#}
{#          <div class="card-body">#}
{#            <h5 class="card-title">ÌÑ∞Ïπò PC</h5>#}
{#            {% for i in 1|range_tag:22 %}#}
{#              {% if i|remainder:6 == 1 %}#}
{#              <div class="row align-items-center">#}
{#              {% endif %}#}
{#              <div class="col-2 mb-2">#}
{#                <button class="btn btn-outline-primary w-100 kvm" name="kvm_button" value="{{ m.id }}-{{ i }}">{{ connect_list|kvm_index:i }}</button>#}
{#              </div>#}
{#              {% if i|remainder:6 == 0 or i == 21 %}#}
{#              </div>#}
{#              {% endif %}#}
{#            {% endfor %}#}
{#          </div>#}
{#        </div>#}
{#        {% endfor %}#}
{#      {% endif %}#}
{##}
{#      {% if matrix %}#}
{#        {% for mat in matrix %}#}
{#        <div class="card matrix-card mb-3 pcSection">#}
{#          <div class="card-body">#}
{#            <h5 class="card-title">{{ mat.name }}</h5>#}
{#            <div class="row">#}
{#              {% for i in 1|range_tag:17 %}#}
{#              <div class="col-3">#}
{#                <div class="control">#}
{#                  <img src="{% static 'img/icon1.png' %}" />#}
{#                </div>#}
{#                <button class="btn btn-outline-primary kvm" name="kvm_button" value="{{ mat.id }}-{{ i }}">{{ mat.main_connect|group_index:i }}</button>#}
{#                <div class="form-group">#}
{#                  <select class="form-control form-control-sm" name="input_select" id="input_select-0{{ i }}-{{ mat.id }}">#}
{#                    {% for j in 1|range_tag:17 %}#}
{#                    <option {% if mat|option_selected:i == j %}selected{% endif %} value="0{{ j }}">{{ mat.main_connect|group_index:j }}</option>#}
{#                    {% endfor %}#}
{#                  </select>#}
{#                </div>#}
{#              </div>#}
{#              {% endfor %}#}
{#            </div>#}
{#          </div>#}
{#        </div>#}
{#        {% endfor %}#}
{#      {% endif %}#}
{##}
{#      <!-- ‚úÖ ÌÜ†Í∏Ä ÏÑπÏÖò: Î∞òÎìúÏãú col-10 ÎÇ¥Î∂ÄÏóê ÏûàÏñ¥Ïïº Ìï® -->#}
{#      <div id="toggleSection" class=" mt-3" style="display: none;">#}
{#        <div class="alert alert-info w-100">#}
{#          <h5>Í∑∏Î£π ÏÑ§Ï†ï</h5>#}
{#          <div class="row">#}
{#            {% for i in 1|range_tag:17 %}#}
{#            <div class="col-1-5 mb-3">#}
{#              <div class="card text-center channel-box" data-chan="{{ i }}">#}
{#                <div class="card-header">CH{{ i }}</div>#}
{#                <div class="card-body p-3">#}
{#                  <h5>In {{ i }}</h5>#}
{#                  <button class="btn btn-sm btn-danger unselect-btn">‚ùå</button>#}
{#                </div>#}
{#              </div>#}
{#            </div>#}
{#            {% endfor %}#}
{#          </div>#}
{#          <div class="mt-3 text-center">#}
{#            <button id="groupBtn" class="btn btn-warning">üîó Group</button>#}
{#            <button id="ungroupBtn" class="btn btn-warning">‚ùå Un group</button>#}
{#          </div>#}
{#        </div>#}
{#      </div>#}
{#    </div>#}
{##}
{#    <!-- Ïö∞Ï∏° Ï¶êÍ≤®Ï∞æÍ∏∞ -->#}
{#    <div class="col-2" style="padding-left: 0;">#}
{#      <div class="card profile-card">#}
{#        {% if profile %}#}
{#        <div class="card-body" style="overflow: auto; max-height: 100vh;">#}
{#          <h5 class="card-title text-center">Ï¶êÍ≤®Ï∞æÍ∏∞</h5>#}
{#          {% for pro in profile %}#}
{#          <div class="row">#}
{#            <button class="btn btn-outline-primary control w-100" name="profile_button" value="{{ pro.id }}">{{ pro.name }}</button>#}
{#          </div>#}
{#          {% endfor %}#}
{#        </div>#}
{#        {% endif %}#}
{#      </div>#}
{#    </div>#}
{#  </div>#}
{#</div>#}
{#{% endblock content %}#}
{##}
{#{% block javascript %}#}
{#<script>#}
{#  document.addEventListener("DOMContentLoaded", () => {#}
{#    const toggleBtn = document.getElementById('toggleBtn');#}
{#    const pcSections = document.querySelectorAll('.pcSection');#}
{#    const toggleSection = document.getElementById('toggleSection');#}
{##}
{#    if (!toggleBtn || !toggleSection || pcSections.length === 0) {#}
{#      console.warn("ÏöîÏÜå ÎàÑÎùΩ ÌôïÏù∏: toggleBtn, toggleSection, .pcSection");#}
{#      return;#}
{#    }#}
{##}
{#    toggleBtn.addEventListener('click', () => {#}
{#      const isVisible = window.getComputedStyle(pcSections[0]).display !== 'none';#}
{#      pcSections.forEach(el => el.style.display = isVisible ? 'none' : 'block');#}
{#      toggleSection.style.display = isVisible ? 'flex' : 'none';#}
{#      toggleBtn.textContent = isVisible ? 'Í∑∏Î£πÎü¨Îãù' : 'ÎπÑÎîîÏò§Ïõî';#}
{#    });#}
{#  });#}
{#</script>#}
{#{% endblock javascript %}#}

{% extends 'base.html' %}
{% load static %} {% load filter_tags %}
{% block content %}


<button class="btn btn-primary layout-toggle-btn" id="layoutToggleBtn" title="Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë">
    <i class="fas fa-grip-horizontal"></i>
</button>

<div class="layout-controls hidden" id="layoutControls">
    <div class="layout-controls-title">
        <h6><i class="fas fa-pen"></i> Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë</h6>
        <p class="layout-controls-subtitle">- Î™®ÎãàÌÑ∞ Î∞∞ÏπòÎ•º ÏûêÏú†Î°≠Í≤å Ï°∞Ï†ïÌïòÏÑ∏Ïöî.</p>
        <p class="layout-controls-subtitle">- Ïù¥Î¶ÑÏùÑ ÏûêÏú†Î°≠Í≤å ÏàòÏ†ïÌïòÏÑ∏Ïöî.</p>
    </div>
    <div class="text-center">
        <button class="btn btn-save btn-sm" id="saveLayoutBtn">
            <i class="fas fa-save"></i> Ï†ÄÏû•
        </button>
        <button class="btn btn-reset btn-sm" id="resetLayoutBtn">
            <i class="fas fa-undo"></i> Ï¥àÍ∏∞Ìôî
        </button>
        <button class="btn btn-close btn-sm" id="closeLayoutBtn">
            <i class="fas fa-times"></i> Îã´Í∏∞
        </button>
    </div>
    <hr style="margin: 15px 0;">
    <h6><i class="fas fa-eye-slash"></i> Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞</h6>
    <div id="hiddenMonitors" style="max-height: 150px; overflow-y: auto;">
        <small class="text-muted">Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</small>
    </div>
</div>

<div class="container-fluid matrix-list" style="overflow-y:auto; max-height:calc(100vh - 80px);">
    <div class="row">
        <div class="col-10">

            <!-- Î©îÏù∏ Îß§Ìä∏Î¶≠Ïä§ (16Ìè¨Ìä∏) -->
            {% if main %}
                {% for m in main %}
                    <div class="card matrix-card main" data-matrix-id="{{ m.id }}">
                        <div class="card-body">
                            <h5 class="card-title text-center">{{ m.name }}</h5>

                            <!-- Ï≤´ Î≤àÏß∏ Ìñâ (1-8) -->
                            <div class="sortable-row" data-row="1" style="position: relative;">
                                {% for i in 1|range_tag:9 %}
                                    <div class="monitor-item"
                                         data-position="{{ i }}"
                                         data-matrix="{{ m.id }}"
                                         data-row="1"
                                         data-col="{{ i }}"
                                         draggable="false">


                                        <div class="monitor-controls">
                                            <button class="btn btn-outline-secondary btn-toggle-visibility"
                                                    title="Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ m.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary btn-edit-names"
                                                    title="Ïù¥Î¶Ñ ÏàòÏ†ï"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ m.id }}"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#updateNamesModal"
                                                    style="display: none;">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>

                                        <div class="control">
                                            <img src="{% static 'img/icon1.png' %}" />
                                            <p class="monitor-label">{{ m|monitor_name:i }}</p>
                                        </div>
                                        <div class="form-group">
                                            <select class="form-control form-control-sm monitor-select"
                                                    name="input_select"
                                                    id="input_select-{{ i|stringformat:"02d" }}-{{ m.id }}">
                                                {% for j in 1|range_tag:17 %}
                                                    <option value="{{ j|stringformat:"02d" }}"
                                                            {% if m|option_selected:i == j %}selected{% endif %}>
                                                        {{ m|device_name:j }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <!-- Îëê Î≤àÏß∏ Ìñâ (9-16) -->
                            <div class="sortable-row" data-row="2" style="position: relative;">
                                {% for i in 9|range_tag:17 %}
                                    <div class="monitor-item"
                                         data-position="{{ i }}"
                                         data-matrix="{{ m.id }}"
                                         data-row="2"
                                         data-col="{{ i|add:'-8' }}"
                                         draggable="false">

                                        <div class="monitor-controls">
                                            <button class="btn btn-outline-secondary btn-toggle-visibility"
                                                    title="Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ m.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary btn-edit-names"
                                                    title="Ïù¥Î¶Ñ ÏàòÏ†ï"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ m.id }}"
                                                    data-toggle="modal"
                                                    data-target="#updateNamesModal"
                                                    style="display: none;">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>

                                        <div class="control">
                                            <img src="{% static 'img/icon1.png' %}" />
                                            <p class="monitor-label">{{ m|monitor_name:i }}</p>
                                        </div>
                                        <div class="form-group">
                                            <select class="form-control form-control-sm monitor-select"
                                                    name="input_select"
                                                    id="input_select-{{ i|stringformat:"02d" }}-{{ m.id }}">
                                                {% for j in 1|range_tag:17 %}
                                                    <option value="{{ j|stringformat:"02d" }}"
                                                            {% if m|option_selected:i == j %}selected{% endif %}>
                                                        {{ m|device_name:j }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>

                    <!-- ÌÑ∞Ïπò PC (KVM) Ïπ¥Îìú -->
                    <div class="card matrix-card main">
                        <div class="card-body">
                            <h5 class="card-title">ÌÑ∞Ïπò PC</h5>
                            {% for i in 1|range_tag:33 %}
                                {% if i|remainder:8 == 1 %}
                                    <div class="row align-items-center">
                                {% endif %}
                            <div class="col-1_5 mb-2">
                                <button class="btn btn-outline-primary w-100 kvm"
                                        name="kvm_button"
                                        value="{{ m.id }}-{{ i }}">
                                    {{ connect_list|kvm_index:i }}
                                </button>
                            </div>
                            {% if i|remainder:8 == 0 or i == 32 %}
                                </div>
                            {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- ÏÑúÎ∏å Îß§Ìä∏Î¶≠Ïä§Îì§ (16Ìè¨Ìä∏) -->
            {% if matrix %}
                {% for mat in matrix %}
                    <div class="card matrix-card" data-matrix-id="{{ mat.id }}">
                        <div class="card-body">
                            <h5 class="card-title">{{ mat.name }}</h5>

                            <!-- Ï≤´ Î≤àÏß∏ Ìñâ (1-8) -->
                            <div class="sortable-row" data-row="1">
                                {% for i in 1|range_tag:9 %}
                                    <div class="monitor-item"
                                         data-position="{{ i }}"
                                         data-matrix="{{ mat.id }}"
                                         data-row="1"
                                         data-col="{{ i }}"
                                         draggable="false">

                                        <div class="monitor-controls">
                                            <button class="btn btn-outline-secondary btn-toggle-visibility"
                                                    title="Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ mat.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary btn-edit-names"
                                                    title="Ïù¥Î¶Ñ ÏàòÏ†ï"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ mat.id }}"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#updateNamesModal"
                                                    style="display: none;">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>

                                        <div class="control">
                                            <img src="{% static 'img/icon1.png' %}" />
                                        </div>
                                        <button class="btn btn-outline-gradient kvm"
                                                name="kvm_button"
                                                value="{{ mat.id }}-{{ i }}">
                                            {{ mat|profile_monitor_name:i }}
                                        </button>
                                        <div class="form-group">
                                            <select class="form-control form-control-sm monitor-select"
                                                    name="input_select"
                                                    id="input_select-{{ i|stringformat:"02d" }}-{{ mat.id }}">
                                                {% for j in 1|range_tag:17 %}
                                                    <option value="{{ j|stringformat:"02d" }}"
                                                            {% if mat|option_selected:i == j %}selected{% endif %}>
                                                        {{ mat|device_name:j }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                            <!-- Îëê Î≤àÏß∏ Ìñâ (9-16) -->
                            <div class="sortable-row" data-row="2">
                                {% for i in 9|range_tag:17 %}
                                    <div class="monitor-item"
                                         data-position="{{ i }}"
                                         data-matrix="{{ mat.id }}"
                                         data-row="2"
                                         data-col="{{ i|add:'-8' }}"
                                         draggable="false">

                                        <div class="monitor-controls">
                                            <button class="btn btn-outline-secondary btn-toggle-visibility"
                                                    title="Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ mat.id }}">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                            <button class="btn btn-outline-secondary btn-edit-names"
                                                    title="Ïù¥Î¶Ñ ÏàòÏ†ï"
                                                    data-position="{{ i }}"
                                                    data-matrix="{{ mat.id }}"
                                                    data-bs-toggle="modal"
                                                    data-bs-target="#updateNamesModal"
                                                    style="display: none;">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                        </div>

                                        <div class="control">
                                            <img src="{% static 'img/icon1.png' %}" />
                                        </div>
                                        <button class="btn btn-outline-gradient kvm"
                                                name="kvm_button"
                                                value="{{ mat.id }}-{{ i }}">
                                            {{ mat|profile_monitor_name:i }}
                                        </button>
                                        <div class="form-group">
                                            <select class="form-control form-control-sm monitor-select"
                                                    name="input_select"
                                                    id="input_select-{{ i|stringformat:"02d" }}-{{ mat.id }}">
                                                {% for j in 1|range_tag:17 %}
                                                    <option value="{{ j|stringformat:"02d" }}"
                                                            {% if mat|option_selected:i == j %}selected{% endif %}>
                                                        {{ mat|device_name:j }}
                                                    </option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>

                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <div id="toggleSection" class="mt-3" style="display: none;">
                <div class="alert alert-info w-100">
                    <h5>Í∑∏Î£π ÏÑ§Ï†ï</h5>
                    <div class="row">
                        {% for i in 1|range_tag:17 %}
                        <div class="col-1-5 mb-3">
                            <div class="card text-center channel-box" data-chan="{{ i }}">
                                <div class="card-header">CH{{ i }}</div>
                                <div class="card-body p-3">
                                    <h5>In {{ i }}</h5>
                                    <button class="btn btn-sm btn-danger unselect-btn">‚ùå</button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="mt-3 text-center">
                        <button id="groupBtn" class="btn btn-warning">üîó Group</button>
                        <button id="ungroupBtn" class="btn btn-warning">‚ùå Un group</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-2 profile-column">
            <div class="card profile-card">
                {% if profile %}
                    <div class="card-header">
                        <h5 class="card-title">Ï¶êÍ≤®Ï∞æÍ∏∞</h5>
                    </div>
                    <div>
                        <div data-simplebar class="card-body">
                            <ul id="favoritesList" class="fav fav--glass">
                                {% for pro in profile %}
                                    <li class="list-group-item">
                                        <button class="fav-btn" name="profile_button" value="{{ pro.id }}">
                                            {{ pro.name }}
                                        </button>
                                    </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% endif %}
            </div>
        </div>

    </div>
</div>


<div class="modal fade" id="profile-update" tabindex="-1" role="dialog" aria-labelledby="profile-update-modal-title" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-md" role="document">
        <div class="modal-content shadow-lg border-0 rounded-3">

            <div class="modal-header bg-primary text-white rounded-top">
                <h5 class="modal-title font-weight-bold" id="profile-update-modal-title">Ï¶êÍ≤®Ï∞æÍ∏∞ ÏàòÏ†ï</h5>
                <button type="button" class="close text-white" onclick="forceCloseModal()" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <form method="post" action="{% url 'profile_detail' %}" id="profile-update-form">
                {% csrf_token %}
                <input type="hidden" name="_method" value="put" />
                <input type="hidden" id="update-id" name="id" />
                <input type="hidden" id="update-mat-id-list" name="mat_id_list" />
                <input type="hidden" id="update-input-1" name="input_a" />
                <input type="hidden" id="update-input-2" name="input_b" />
                <input type="hidden" id="update-input-3" name="input_c" />
                <input type="hidden" id="update-input-4" name="input_d" />
                <input type="hidden" id="update-input-5" name="input_e" />
                <input type="hidden" id="update-input-6" name="input_f" />
                <input type="hidden" id="update-input-7" name="input_g" />
                <input type="hidden" id="update-input-8" name="input_h" />

                <input type="hidden" id="update-input-9" name="input_i" />
                <input type="hidden" id="update-input-10" name="input_j" />
                <input type="hidden" id="update-input-11" name="input_k" />
                <input type="hidden" id="update-input-12" name="input_l" />
                <input type="hidden" id="update-input-13" name="input_m" />
                <input type="hidden" id="update-input-14" name="input_n" />
                <input type="hidden" id="update-input-15" name="input_o" />
                <input type="hidden" id="update-input-16" name="input_p" />
                <input type="hidden" id="update-input-kvm" name="input_kvm" />

                <div class="modal-body px-4 py-3">
                    <div class="form-group mb-4">
                        <label for="input-name-update" class="font-weight-bold">Ï¶êÍ≤®Ï∞æÍ∏∞Î™Ö</label>
                        <input hidden="hidden" />
                        <input
                                type="text"
                                class="form-control form-control-lg"
                                id="input-name-update"
                                name="name"
                                placeholder="Ïòà: ÎπµÎ∞©Íµ¨"
                                required
                        />
                        <div id="update-name-feedback" class="invalid-feedback">Ïù¥Î¶ÑÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.</div>
                    </div>

                    {% if main_mat %}
                    {% for mat in main_mat %}
                    <h5 class="mt-4 font-weight-bold">{{mat.name}}</h5>
                    <input type="hidden" class="update-system-id" value="{{mat.id}}" />

                    <!-- Ï≤´ Î≤àÏß∏ Ìñâ (1-8) -->
                    <div class="form-row">
                        {% for i in 1|range_tag:9 %}
                        <div class="form-group col-md-3 mb-3">
                            <label for="update-input-select-{{mat.id}}-{{i}}">{{ mat|monitor_name:i }}</label>
                            <select id="update-input-select-{{mat.id}}-{{i}}" class="form-control form-control-sm update-select-{{i}}">
                                {% for j in 0|range_tag:17 %}
                                <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">
                                    {% if j == 0 %}-{% else %}{{ mat|device_name:j }}{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Îëê Î≤àÏß∏ Ìñâ (9-16) -->
                    <div class="form-row">
                        {% for i in 9|range_tag:17 %}
                        <div class="form-group col-md-3 mb-3">
                            <label for="update-input-select-{{mat.id}}-{{i}}">{{ mat|monitor_name:i }}</label>
                            <select id="update-input-select-{{mat.id}}-{{i}}" class="form-control form-control-sm update-select-{{i}}">
                                {% for j in 0|range_tag:17 %}
                                <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">
                                    {% if j == 0 %}-{% else %}{{ mat|device_name:j }}{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- KVM ÏÑ§Ï†ï -->
                    <div class="form-row">
                        <div class="form-group col-md-3 mb-3">
                            <label for="update-main-input-kvm">USB</label>
                            <select id="update-main-input-kvm" class="form-control form-control-sm update-input-kvm">
                                {% for j in 0|range_tag:33 %}
                                <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">{{ connect_list|kvm_index:j }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}

                    <!-- ÏÑúÎ∏å Îß§Ìä∏Î¶≠Ïä§ ÏÑ§Ï†ï -->
                    {% if sub_mat %}
                    {% for mat in sub_mat %}
                    <h5 class="mt-4 font-weight-bold">{{ mat.name }}</h5>
                    <input type="hidden" class="update-system-id" value="{{ mat.id }}" />

                    <!-- Ï≤´ Î≤àÏß∏ Ìñâ (1-8) -->
                    <div class="form-row">
                        {% for i in 1|range_tag:9 %}
                            <div class="form-group col-md-3 mb-3">
                                <label for="update-input-select-{{ mat.id }}-{{ i }}">{{ mat|profile_monitor_name:i }}</label>
                                <select id="update-input-select-{{ mat.id }}-{{ i }}" class="form-control form-control-sm update-select-{{ i }}">
                                    {% for j in 0|range_tag:17 %}
                                        <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">
                                            {% if j == 0 %}-{% else %}{{ mat|device_name:j }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- Îëê Î≤àÏß∏ Ìñâ (9-16) -->
                    <div class="form-row">
                        {% for i in 9|range_tag:17 %}
                            <div class="form-group col-md-3 mb-3">
                                <label for="update-input-select-{{ mat.id }}-{{ i }}">{{ mat|profile_monitor_name:i }}</label>
                                <select id="update-input-select-{{ mat.id }}-{{ i }}" class="form-control form-control-sm update-select-{{ i }}">
                                    {% for j in 0|range_tag:17 %}
                                        <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">
                                            {% if j == 0 %}-{% else %}{{ mat|device_name:j }}{% endif %}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- KVM ÏÑ§Ï†ï -->
                    <div class="form-row">
                        <div class="form-group col-md-3 mb-3">
                            <label for="update-sub-input-kvm-{{ mat.main_connect }}">USB</label>
                            <select id="update-sub-input-kvm-{{ mat.main_connect }}" class="form-control form-control-sm update-input-kvm">
                                {% for j in 0|range_tag:17 %}
                                    <option {% if j == 0 %}selected{% endif %} value="{{ j|stringformat:"02d" }}">{{ mat|device_name:j }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>

                <div class="modal-footer bg-light border-top-0 rounded-bottom px-4 py-3">
                    <button type="button" class="btn btn-modal-secondary" onclick="forceCloseModal()">Ï∑®ÏÜå</button>
                    <button type="button" class="btn btn-modal-primary" onClick="profileUpdate()">ÏàòÏ†ï</button>
                </div>
            </form>

        </div>
    </div>
</div>


<!-- <script src="{% static 'js/hardware_polling.js' %}"></script> -->


<div class="modal fade" id="updateNamesModal" tabindex="-1">
    <div class="modal-dialog">
        <form id="updateNamesForm" method="post">
            {% csrf_token %}
            <input type="hidden" id="modal-position" name="position" value="">
            <input type="hidden" id="modal-matrix-id" name="matrix_id" value="">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Î™®ÎãàÌÑ∞¬∑ÎîîÎ∞îÏù¥Ïä§ Ïù¥Î¶Ñ ÏàòÏ†ï</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Î™®ÎãàÌÑ∞ Ïù¥Î¶Ñ</label>
                        <input type="text" class="form-control" id="modal-monitor-name"
                               name="monitor_name" value="">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ÎîîÎ∞îÏù¥Ïä§ Ïù¥Î¶Ñ</label>
                        <input type="text" class="form-control" id="modal-device-name"
                               name="device_name" value="">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-modal-secondary" data-bs-dismiss="modal">Ï∑®ÏÜå</button>
                    <button type="submit" class="btn btn-modal-primary">Ï†ÄÏû•</button>
                </div>
            </div>
        </form>
    </div>
</div>

{% include 'modal/error_modal.html' %}

<!-- Loading Modal -->
<div class="modal fade" id="loadingModal" tabindex="-1" data-backdrop="static" data-keyboard="false" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content" style="background-color: rgba(255, 255, 255, 0); border: none">
            <div class="modal-body">
                <div class="text-center">
                    <div class="spinner-border text-primary" style="width: 3rem; height: 3rem" role="status"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    /* 16Ìè¨Ìä∏Ïö© Ïä§ÌÉÄÏùº */
    .kvm, .monitor-label, .monitor-select {
        display: block;
        width: 100%;
        margin-top: .25rem;
        padding: .375rem .75rem;
        border: 1px solid #d1d5db;
        border-radius: .375rem;
        background-color: #fff;
        color: #000000;
        font-weight: 500;
        text-align: center;
        line-height: 1.5;
        box-shadow: none;
    }

    .monitor-select {
        appearance: none;
        -webkit-appearance: none;
        -moz-appearance: none;
        background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
        background-repeat: no-repeat;
        background-position: right 8px center;
        background-size: 16px;
        padding-right: 32px;
        outline: 0;
    }
    .monitor-select:focus,
    .monitor-select:hover {
        border-color: #cfd4da;
        box-shadow: none;
    }
    .monitor-select:disabled {
        background-color: #f8f9fa;
        color: #9ca3af;
        border-style: dashed;
        cursor: not-allowed;
    }
    .kvm-active-border {
        border: 3px solid #343a40;
        border-radius: 12px;
        padding: 4px;
    }

    /* 16Ìè¨Ìä∏Ïö© Í∑∏Î¶¨Îìú Ï°∞Ï†ï */
    .sortable-row {
        display: grid;
        grid-template-columns: repeat(8, 1fr);
        gap: 10px;
        margin-bottom: 15px;
    }


    .fav { --gap:10px; --radius:12px; --padY:10px; --padX:14px; --h:42px; }
    .fav { margin:0; padding:8px; list-style:none; }

    .fav .list-group-item{
        display:flex; align-items:center; gap:12px;
        padding:6px 4px; border:0; background:transparent;
    }
    .fav .list-group-item + .list-group-item{ margin-top: var(--gap); }

    .fav .fav-btn{
        flex:1 1 auto; width:100%; height:var(--h);
        padding: var(--padY) var(--padX);
        border-radius: var(--radius);
        border:1px solid transparent;
        font-weight:600; letter-spacing:.2px; text-align:center;
        transition: .15s ease;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        line-height: 1 !important;
    }

    .fav .list-group-item.dragging{ opacity:.75; }
    .fav .list-group-item.drop-target{ outline:2px dashed #cbd5e1; outline-offset:4px; border-radius:12px; }

    .fav.fav--glass .fav-btn{
        background: rgba(255,255,255,.65);
        border: 1px solid rgba(0,0,0,.15) !important;
        box-shadow: 0 8px 24px rgba(15,23,42,.08), inset 0 1px 0 rgba(255,255,255,.6);
        backdrop-filter: blur(8px);
        color:#0f172a;
    }
    .fav.fav--glass .fav-btn:hover{
        transform: translateY(-1px);
        box-shadow: 0 12px 28px rgba(15,23,42,.12);
        border-color: rgba(55, 60, 62, 0.6) !important;
    }
    .fav.fav--glass .fav-btn:focus{ outline:none; box-shadow: 0 0 0 .2rem rgba(59,130,246,.18); }

    /* Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë Î™®Îìú Ïä§ÌÉÄÏùº */
    .layout-controls {
        position: fixed;
        bottom: 80px;
        right: 20px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        z-index: 1000;
        width: 300px;
        transition: all 0.3s ease;
        opacity: 0;
        transform: translateX(100%);
    }

    .layout-controls.show {
        opacity: 1;
        transform: translateX(0);
    }

    .layout-controls.hidden {
        display: none;
    }

    .layout-toggle-btn {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1001;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .layout-toggle-btn.editing {
        background-color: #dc3545;
        border-color: #dc3545;
    }

    .matrix-card.editing-mode {
        border: 2px dashed #007bff;
    }

    .monitor-controls {
        position: absolute;
        top: -10px;
        right: -10px;
        z-index: 100;
        display: none;
        gap: 5px;
    }

    .matrix-card.editing-mode .monitor-controls {
        display: flex;
    }

    .monitor-item {
        position: relative;
        padding: 10px;
        border: 1px solid transparent;
        border-radius: 8px;
        transition: all 0.3s ease;
    }

    .monitor-item.hidden {
        opacity: 0.3;
        transform: scale(0.9);
    }

    .btn-toggle-visibility, .btn-edit-names {
        width: 30px;
        height: 30px;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
    }

    /* 16Ìè¨Ìä∏Ïö© col-1_5 Ïä§ÌÉÄÏùº */
    .col-1_5 {
        flex: 0 0 12.5%;
        max-width: 12.5%;
        padding-right: 7.5px;
        padding-left: 7.5px;
    }

    /* ÌîÑÎ°úÌïÑ Î™®Îã¨ Ïä§ÌÉÄÏùº */
    .btn-modal-primary {
        background-color: #007bff;
        border-color: #007bff;
        color: white;
    }

    .btn-modal-primary:hover {
        background-color: #0056b3;
        border-color: #0056b3;
    }

    .btn-modal-secondary {
        background-color: #6c757d;
        border-color: #6c757d;
        color: white;
    }

    .btn-modal-secondary:hover {
        background-color: #545b62;
        border-color: #545b62;
    }

    .form-row {
        display: flex;
        flex-wrap: wrap;
        margin-right: -5px;
        margin-left: -5px;
    }

    .form-row .form-group {
        padding-right: 5px;
        padding-left: 5px;
    }

    /* 8Ìè¨Ìä∏ÏóêÏÑú Í∞ÄÏ†∏Ïò® Ïï†ÎãàÎ©îÏù¥ÏÖò CSS */
    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes slideDown {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }

    /* ÎìúÎûòÍ∑∏ ÏÉÅÌÉú Ïä§ÌÉÄÏùº */
    .monitor-item.dragging {
        opacity: 0.5;
        transform: rotate(5deg);
    }

    .sortable-row.drag-over {
        background-color: rgba(0, 123, 255, 0.1);
        border: 2px dashed #007bff;
        border-radius: 8px;
    }

    .monitor-item.drag-over-element {
        border: 2px solid #007bff;
        background-color: rgba(0, 123, 255, 0.1);
    }

    /* Î≥¥ÎùºÏÉâ Í∑∏ÎùºÎîîÏñ∏Ìä∏ Î≤ÑÌäº Ïä§ÌÉÄÏùº */
    .btn-gradient {
        background: linear-gradient(45deg, #667eea, #764ba2);
        border: none;
        color: white;
        transition: all 0.3s ease;
    }

    .btn-gradient:hover {
        background: linear-gradient(45deg, #764ba2, #667eea);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
    }

    .btn-gradient:active {
        transform: translateY(0);
        box-shadow: 0 2px 4px rgba(102, 126, 234, 0.4);
    }

    .btn-outline-gradient {
        background: transparent;
        border: 2px solid transparent;
        background-image: linear-gradient(white, white),
        linear-gradient(45deg, #667eea, #764ba2);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        color: #000000;
        transition: all 0.3s ease;
    }

    .btn-outline-gradient:hover {
        background: linear-gradient(45deg, #667eea, #764ba2);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(102, 126, 234, 0.4);
    }

    .kvm-active-border-gradient {
        position: relative;
        border: 3px solid transparent;
        background-image: linear-gradient(white, white),
        linear-gradient(45deg, #667eea, #764ba2);
        background-origin: border-box;
        background-clip: padding-box, border-box;
        animation: borderPulse 2s ease-in-out infinite;
        border-radius: 10px;
    }

    @keyframes borderPulse {
        0%, 100% {
            opacity: 1;
        }
        50% {
            opacity: 0.8;
        }
    }

    .btn-gradient:focus,
    .btn-outline-gradient:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.3);
    }
</style>

{% endblock content %}

{% block javascript %}
<!-- jQuery ÎùºÏù¥Î∏åÎü¨Î¶¨ Î°úÎìú -->
<script src="{% static 'vendor/jquery/jquery.min.js' %}"></script>
<script src="{% static 'vendor/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/home.js' %}"></script>

<script>
    // 8Ìè¨Ìä∏ÏóêÏÑú Í∞ÄÏ†∏Ïò® Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë Í∏∞Îä• Î≥ÄÏàòÎì§
    let isLayoutMode = false;
    let draggedElement = null;

    // Î†àÏù¥ÏïÑÏõÉ Î™®Îìú ÌÜ†Í∏Ä
    $(document).on('click', '#layoutToggleBtn', function() {
        console.log('Layout toggle clicked, current mode:', isLayoutMode);
        isLayoutMode = !isLayoutMode;
        if (isLayoutMode) {
            enterLayoutMode();
        } else {
            exitLayoutMode();
        }
    });

    // Î†àÏù¥ÏïÑÏõÉ Î™®Îìú ÏßÑÏûÖ
    function enterLayoutMode() {
        console.log('Entering layout mode');
        const $btn = $('#layoutToggleBtn');
        const $controls = $('#layoutControls');

        // Î≤ÑÌäº Ïä§ÌÉÄÏùº Î≥ÄÍ≤Ω
        $btn.addClass('editing');
        $btn.html('<i class="fas fa-stop"></i>');
        $btn.attr('title', 'Ìé∏Ïßë Ï§ëÏßÄ');

        // Ï†úÏñ¥ Ìå®ÎÑê ÌëúÏãú
        $controls.removeClass('hidden');
        setTimeout(() => $controls.addClass('show'), 50);

        // Ìé∏Ïßë Î™®Îìú ÌôúÏÑ±Ìôî
        $('.matrix-card').addClass('editing-mode');

        // Ïù¥Î¶Ñ ÏàòÏ†ï Î≤ÑÌäº ÌëúÏãú
        $('.btn-edit-names').show();

        // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ ÌôúÏÑ±Ìôî
        enableDragAndDrop();

        // Í∏∞Ï°¥ Ï†úÏñ¥ ÎπÑÌôúÏÑ±Ìôî
        $('select[name=input_select]').prop('disabled', true);
        $('button[name=kvm_button]').prop('disabled', true);

        updateHiddenMonitorsList();
        showEditingToast();
    }

    // Î†àÏù¥ÏïÑÏõÉ Î™®Îìú Ï¢ÖÎ£å
    function exitLayoutMode() {
        console.log('Exiting layout mode');
        const $btn = $('#layoutToggleBtn');
        const $controls = $('#layoutControls');

        // Î≤ÑÌäº Ïä§ÌÉÄÏùº Î≥µÍµ¨
        $btn.removeClass('editing');
        $btn.html('<i class="fas fa-grip-horizontal"></i>');
        $btn.attr('title', 'Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë');

        // Ï†úÏñ¥ Ìå®ÎÑê Ïà®ÍπÄ
        $controls.removeClass('show');
        setTimeout(() => $controls.addClass('hidden'), 300);

        // Ìé∏Ïßë Î™®Îìú ÎπÑÌôúÏÑ±Ìôî
        $('.matrix-card').removeClass('editing-mode');

        // Ïù¥Î¶Ñ ÏàòÏ†ï Î≤ÑÌäº Ïà®ÍπÄ
        $('.btn-edit-names').hide();

        // ÎìúÎûòÍ∑∏ Ïù¥Î≤§Ìä∏ ÎπÑÌôúÏÑ±Ìôî
        disableDragAndDrop();

        // Í∏∞Ï°¥ Ï†úÏñ¥ ÌôúÏÑ±Ìôî
        $('select[name=input_select]').prop('disabled', false);
        $('button[name=kvm_button]').prop('disabled', false);
    }

    // ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ ÌôúÏÑ±Ìôî
    function enableDragAndDrop() {
        console.log('Enabling drag and drop');
        $('.monitor-item').attr('draggable', true);

        $('.monitor-item').off('dragstart dragend dragover');
        $('.sortable-row').off('dragover dragleave drop');

        $('.monitor-item').on('dragstart', function(e) {
            draggedElement = this;
            $(this).addClass('dragging');
            e.originalEvent.dataTransfer.effectAllowed = 'move';
            e.originalEvent.dataTransfer.setData('text/html', this.innerHTML);
            console.log('Drag started:', $(this).data('position'));
        });

        $('.monitor-item').on('dragend', function(e) {
            $(this).removeClass('dragging');
            $('.drag-over').removeClass('drag-over');
            $('.drag-over-element').removeClass('drag-over-element');
            draggedElement = null;
            console.log('Drag ended');
        });

        $('.monitor-item').on('dragover', function(e) {
            if (this === draggedElement) return;

            e.preventDefault();
            e.stopPropagation();

            const draggingItem = $(draggedElement);
            const targetItem = $(this);
            const targetRow = targetItem.closest('.sortable-row');

            // ÎßàÏö∞Ïä§ ÏúÑÏπòÏóê Îî∞Îùº Ïïû/Îí§ Í≤∞Ï†ï
            const rect = this.getBoundingClientRect();
            const midpoint = rect.left + rect.width / 2;

            if (e.originalEvent.clientX < midpoint) {
                // ÏôºÏ™ΩÏóê ÎìúÎ°≠ - ÌÉÄÍ≤ü ÏïûÏóê ÏÇΩÏûÖ
                targetItem.before(draggingItem);
            } else {
                // Ïò§Î•∏Ï™ΩÏóê ÎìúÎ°≠ - ÌÉÄÍ≤ü Îí§Ïóê ÏÇΩÏûÖ
                targetItem.after(draggingItem);
            }

            // row ÏÜçÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            const newRow = targetRow.data('row');
            draggingItem.attr('data-row', newRow);

            // ÏãúÍ∞ÅÏ†Å ÌîºÎìúÎ∞±
            $(this).addClass('drag-over-element');
        });

        $('.monitor-item').on('dragleave', function(e) {
            $(this).removeClass('drag-over-element');
        });

        $('.sortable-row').on('dragover', function(e) {
            e.preventDefault();
            $(this).addClass('drag-over');

            // Îπà rowÏóê ÎìúÎ°≠Ìï† Îïå
            if ($(this).find('.monitor-item').length === 0) {
                if (draggedElement) {
                    $(this).append(draggedElement);
                    const dropRow = $(this).data('row');
                    $(draggedElement).attr('data-row', dropRow);
                }
            }
        });

        $('.sortable-row').on('dragleave', function(e) {
            if (!$(e.relatedTarget).closest('.sortable-row').is(this)) {
                $(this).removeClass('drag-over');
            }
        });

        $('.sortable-row').on('drop', function(e) {
            e.preventDefault();
            e.stopPropagation();
            $(this).removeClass('drag-over');

            console.log('Item dropped in row:', $(this).data('row'));
        });
    }

    // ÎìúÎûòÍ∑∏Ïï§ÎìúÎ°≠ ÎπÑÌôúÏÑ±Ìôî
    function disableDragAndDrop() {
        console.log('Disabling drag and drop');
        $('.monitor-item').attr('draggable', false);
        $('.monitor-item').off('dragstart dragend');
        $('.sortable-row').off('dragover dragleave drop');
    }

    // Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞ Î≤ÑÌäº ÌÅ¥Î¶≠
    $(document).on('click', '.btn-toggle-visibility', function(e) {
        e.preventDefault();
        e.stopPropagation();

        if (!isLayoutMode) {
            showErrorToast('Ìé∏Ïßë Î™®ÎìúÏóêÏÑúÎßå Ïà®Í∏∞Í∏∞/Î≥¥Ïù¥Í∏∞Í∞Ä Í∞ÄÎä•Ìï©ÎãàÎã§.');
            return;
        }

        const $monitor = $(this).closest('.monitor-item');
        const $button = $(this);

        if ($monitor.hasClass('hidden')) {
            $monitor.removeClass('hidden');
            $button.find('i').removeClass('fa-eye-slash').addClass('fa-eye');
            $button.attr('title', 'Ïà®Í∏∞Í∏∞');
            showSuccessToast('Î™®ÎãàÌÑ∞Í∞Ä ÌëúÏãúÎê©ÎãàÎã§.');
        } else {
            $monitor.addClass('hidden');
            $button.find('i').removeClass('fa-eye').addClass('fa-eye-slash');
            $button.attr('title', 'Î≥¥Ïù¥Í∏∞');
            showSuccessToast('Î™®ÎãàÌÑ∞Í∞Ä Ïà®Í≤®ÏßëÎãàÎã§.');
        }

        updateHiddenMonitorsList();
    });

    // Î†àÏù¥ÏïÑÏõÉ Ï†ÄÏû•
    $(document).on('click', '#saveLayoutBtn', function() {
    console.log('Save layout clicked');
    if (!isLayoutMode) {
        showErrorToast('Ìé∏Ïßë Î™®ÎìúÏóêÏÑúÎßå Ï†ÄÏû•Ìï† Ïàò ÏûàÏäµÎãàÎã§.');
        return;
    }

    // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
    const $btn = $(this);
    const originalHtml = $btn.html();
    $btn.html('<i class="fas fa-spinner fa-spin"></i> Ï†ÄÏû• Ï§ë...');
    $btn.prop('disabled', true);

    // ÌòÑÏû¨ Î†àÏù¥ÏïÑÏõÉ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë
    const layoutData = collectLayoutData();

    // ÏÑúÎ≤ÑÏóê Ï†ÄÏû• ÏöîÏ≤≠
    saveLayoutToServer(layoutData)
        .then(response => {
            if (response.success) {
                showSuccessToast('Î†àÏù¥ÏïÑÏõÉÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
            } else {
                showErrorToast('Ï†ÄÏû• Ïã§Ìå®: ' + response.message);
            }
        })
        .catch(error => {
            console.error('Save error:', error);
            showErrorToast('Ï†ÄÏû• Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        })
        .finally(() => {
            // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÍµ¨
            $btn.html(originalHtml);
            $btn.prop('disabled', false);
        });
});

    function collectLayoutData() {
    const layoutData = [];

    $('.matrix-card').each(function() {
        const matrixId = $(this).data('matrix-id');
        const monitors = [];

        $(this).find('.monitor-item').each(function(index) {
            const $monitor = $(this);
            const position = parseInt($monitor.data('position'));
            const row = parseInt($monitor.data('row'));
            const col = parseInt($monitor.data('col'));
            const isVisible = !$monitor.hasClass('hidden');

            monitors.push({
                position: position,
                row: row,
                col: col,
                display_order: index,
                is_visible: isVisible
            });
        });

        layoutData.push({
            matrix_id: matrixId,
            monitors: monitors
        });
    });

    console.log('Collected layout data:', layoutData);
    return layoutData;
}

function saveLayoutToServer(layoutData) {
    return fetch('/api/save-layout/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')  // CSRF ÌÜ†ÌÅ∞ ÌïÑÏöî
        },
        body: JSON.stringify({
            layout_data: layoutData
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    });
}

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    function loadSavedLayout() {
    $('.matrix-card').each(function() {
        const matrixId = $(this).data('matrix-id');
        const $matrixCard = $(this);

        fetch(`/api/get-layout/${matrixId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.success && data.layout_data && data.layout_data.length > 0) {
                    // Ï†ÄÏû•Îêú Î†àÏù¥ÏïÑÏõÉÏù¥ ÏûàÏúºÎ©¥ Ï†ÅÏö©
                    applyLayoutData(matrixId, data.layout_data);
                } else {
                    // Ï†ÄÏû•Îêú Î†àÏù¥ÏïÑÏõÉÏù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉ Ï†ÅÏö©
                    console.log('No saved layout found for matrix:', matrixId, 'applying default layout');
                    resetToDefaultLayout($matrixCard);
                }
            })
            .catch(error => {
                console.log('Layout load error for matrix:', matrixId, error);
                // Ïò§Î•ò Î∞úÏÉùÏãúÏóêÎèÑ Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉ Ï†ÅÏö©
                resetToDefaultLayout($matrixCard);
            });
    });
}

function applyLayoutData(matrixId, layoutData) {
    const $matrixCard = $(`.matrix-card[data-matrix-id="${matrixId}"]`);

    layoutData.forEach(monitorData => {
        const $monitor = $matrixCard.find(`.monitor-item[data-position="${monitorData.position}"]`);

        if ($monitor.length > 0) {
            // ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
            $monitor.attr('data-row', monitorData.row);
            $monitor.attr('data-col', monitorData.col);

            // Í∞ÄÏãúÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            if (monitorData.is_visible) {
                $monitor.removeClass('hidden');
                $monitor.find('.btn-toggle-visibility i').removeClass('fa-eye-slash').addClass('fa-eye');
                $monitor.find('.btn-toggle-visibility').attr('title', 'Ïà®Í∏∞Í∏∞');
            } else {
                $monitor.addClass('hidden');
                $monitor.find('.btn-toggle-visibility i').removeClass('fa-eye').addClass('fa-eye-slash');
                $monitor.find('.btn-toggle-visibility').attr('title', 'Î≥¥Ïù¥Í∏∞');
            }
        }
    });

    // ÏàúÏÑúÏóê Îî∞Îùº Îã§Ïãú Ï†ïÎ†¨
    reorganizeMonitors($matrixCard, layoutData);
}

function reorganizeMonitors($matrixCard, layoutData) {
    // ÌñâÎ≥ÑÎ°ú Í∑∏Î£πÌôî
    const row1Monitors = [];
    const row2Monitors = [];

    layoutData.forEach(monitorData => {
        const $monitor = $matrixCard.find(`.monitor-item[data-position="${monitorData.position}"]`);
        if ($monitor.length > 0) {
            if (monitorData.row === 1) {
                row1Monitors.push({ element: $monitor[0], order: monitorData.display_order });
            } else if (monitorData.row === 2) {
                row2Monitors.push({ element: $monitor[0], order: monitorData.display_order });
            }
        }
    });

    // ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨
    row1Monitors.sort((a, b) => a.order - b.order);
    row2Monitors.sort((a, b) => a.order - b.order);

    // DOMÏóê ÏàúÏÑúÎåÄÎ°ú Ïû¨Î∞∞Ïπò
    const $row1 = $matrixCard.find('.sortable-row[data-row="1"]');
    const $row2 = $matrixCard.find('.sortable-row[data-row="2"]');

    $row1.empty();
    $row2.empty();

    row1Monitors.forEach(item => $row1.append(item.element));
    row2Monitors.forEach(item => $row2.append(item.element));
}



// 9. Í∏∞Ï°¥ ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ Ìï®ÏàòÎì§Ïù¥ ÏóÜÎã§Î©¥ Ï∂îÍ∞Ä
function showSuccessToast(message) {
    // Bootstrap toastÎÇò Îã§Î•∏ ÏïåÎ¶º ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏÇ¨Ïö©
    // ÏûÑÏãúÎ°ú alert ÏÇ¨Ïö© (Ïã§Ï†úÎ°úÎäî Îçî ÎÇòÏùÄ UI Íµ¨ÌòÑ Í∂åÏû•)
    alert('ÏÑ±Í≥µ: ' + message);
}

function showErrorToast(message) {
    // Bootstrap toastÎÇò Îã§Î•∏ ÏïåÎ¶º ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏÇ¨Ïö©
    // ÏûÑÏãúÎ°ú alert ÏÇ¨Ïö© (Ïã§Ï†úÎ°úÎäî Îçî ÎÇòÏùÄ UI Íµ¨ÌòÑ Í∂åÏû•)
    alert('Ïò§Î•ò: ' + message);
}

function showEditingToast() {
    showSuccessToast('Ìé∏Ïßë Î™®ÎìúÍ∞Ä ÌôúÏÑ±ÌôîÎêòÏóàÏäµÎãàÎã§. Î™®ÎãàÌÑ∞Î•º ÎìúÎûòÍ∑∏ÌïòÏó¨ ÏúÑÏπòÎ•º Î≥ÄÍ≤ΩÌïòÏÑ∏Ïöî.');
}



    // Î†àÏù¥ÏïÑÏõÉ Î¶¨ÏÖã
   $(document).on('click', '#resetLayoutBtn', function() {
    console.log('Reset layout clicked');

    if (!confirm('Î™®Îì† Î†àÏù¥ÏïÑÏõÉÏùÑ Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?\nÏù¥ ÏûëÏóÖÏùÄ ÎêòÎèåÎ¶¥ Ïàò ÏóÜÏäµÎãàÎã§.')) {
        return;
    }

    // Î°úÎî© ÏÉÅÌÉú ÌëúÏãú
    const $btn = $(this);
    const originalHtml = $btn.html();
    $btn.html('<i class="fas fa-spinner fa-spin"></i> Ï¥àÍ∏∞Ìôî Ï§ë...');
    $btn.prop('disabled', true);

    // Î™®Îì† Îß§Ìä∏Î¶≠Ïä§Ïùò Î†àÏù¥ÏïÑÏõÉ Ï¥àÍ∏∞Ìôî
    const matrixIds = [];
    $('.matrix-card').each(function() {
        const matrixId = $(this).data('matrix-id');
        if (matrixId) {
            matrixIds.push(matrixId);
        }
    });

    if (matrixIds.length === 0) {
        showErrorToast('Ï¥àÍ∏∞ÌôîÌï† Îß§Ìä∏Î¶≠Ïä§Í∞Ä ÏóÜÏäµÎãàÎã§.');
        $btn.html(originalHtml);
        $btn.prop('disabled', false);
        return;
    }

    // ÏÑúÎ≤ÑÏóê Ï¥àÍ∏∞Ìôî ÏöîÏ≤≠
    resetLayoutOnServer(matrixIds)
        .then(response => {
            if (response.success) {
                // UIÎ•º Í∏∞Î≥∏ ÏÉÅÌÉúÎ°ú Î≥µÏõê
                resetLayoutUI();
                showSuccessToast('Î†àÏù¥ÏïÑÏõÉÏù¥ Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.');
            } else {
                showErrorToast('Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ' + response.message);
            }
        })
        .catch(error => {
            console.error('Reset error:', error);
            showErrorToast('Ï¥àÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        })
        .finally(() => {
            // Î≤ÑÌäº ÏÉÅÌÉú Î≥µÍµ¨
            $btn.html(originalHtml);
            $btn.prop('disabled', false);
        });
});

function resetLayoutOnServer(matrixIds) {
    return fetch('/api/reset-layout/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify({
            matrix_ids: matrixIds
        })
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    });
}

function resetLayoutUI() {
    console.log('Resetting layout UI to default state');

    $('.matrix-card').each(function() {
        const $matrixCard = $(this);
        const matrixId = $matrixCard.data('matrix-id');

        // Î™®Îì† Î™®ÎãàÌÑ∞Î•º ÌëúÏãú ÏÉÅÌÉúÎ°ú Î≥ÄÍ≤Ω
        $matrixCard.find('.monitor-item').removeClass('hidden');
        $matrixCard.find('.btn-toggle-visibility i').removeClass('fa-eye-slash').addClass('fa-eye');
        $matrixCard.find('.btn-toggle-visibility').attr('title', 'Ïà®Í∏∞Í∏∞');

        // 16Ìè¨Ìä∏ Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉÏúºÎ°ú Ïû¨Ï†ïÎ†¨
        resetToDefaultLayout($matrixCard);
    });

    // Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
    updateHiddenMonitorsList();

    console.log('Layout UI reset completed');
}

function resetToDefaultLayout($matrixCard) {
    const $row1 = $matrixCard.find('.sortable-row[data-row="1"]');
    const $row2 = $matrixCard.find('.sortable-row[data-row="2"]');

    // Í∏∞Ï°¥ Î™®ÎãàÌÑ∞ ÏöîÏÜåÎì§ÏùÑ ÏàòÏßë
    const allMonitors = $matrixCard.find('.monitor-item').detach();

    // Ìè¨ÏßÄÏÖò ÏàúÏÑúÎåÄÎ°ú Ï†ïÎ†¨
    const sortedMonitors = allMonitors.toArray().sort((a, b) => {
        return parseInt($(a).data('position')) - parseInt($(b).data('position'));
    });

    // Ìñâ ÎπÑÏö∞Í∏∞
    $row1.empty();
    $row2.empty();

    // Í∏∞Î≥∏ Î†àÏù¥ÏïÑÏõÉÏúºÎ°ú Ïû¨Î∞∞Ïπò (1-8: Ï≤´ Î≤àÏß∏ Ìñâ, 9-16: Îëê Î≤àÏß∏ Ìñâ)
    sortedMonitors.forEach((monitor, index) => {
        const $monitor = $(monitor);
        const position = parseInt($monitor.data('position'));

        if (position <= 8) {
            // Ï≤´ Î≤àÏß∏ Ìñâ (1-8)
            $monitor.attr('data-row', 1);
            $monitor.attr('data-col', position);
            $row1.append($monitor);
        } else {
            // Îëê Î≤àÏß∏ Ìñâ (9-16)
            $monitor.attr('data-row', 2);
            $monitor.attr('data-col', position - 8);
            $row2.append($monitor);
        }

        // Î™®ÎãàÌÑ∞Î•º ÌëúÏãú ÏÉÅÌÉúÎ°ú ÏÑ§Ï†ï
        $monitor.removeClass('hidden');
        $monitor.find('.btn-toggle-visibility i').removeClass('fa-eye-slash').addClass('fa-eye');
        $monitor.find('.btn-toggle-visibility').attr('title', 'Ïà®Í∏∞Í∏∞');
    });

    console.log('Default layout applied for matrix:', $matrixCard.data('matrix-id'));
}

    // Î†àÏù¥ÏïÑÏõÉ Ìé∏Ïßë Îã´Í∏∞
    $(document).on('click', '#closeLayoutBtn', function() {
        console.log('Close layout clicked');
        exitLayoutMode();
        isLayoutMode = false;
    });

    // Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞ Î™©Î°ù ÏóÖÎç∞Ïù¥Ìä∏
    function updateHiddenMonitorsList() {
        const hiddenMonitors = [];

        $('.monitor-item.hidden').each(function() {
            const position = $(this).data('position');
            const matrixId = $(this).data('matrix');
            const name = $(this).find('.monitor-label').text() || `Î™®ÎãàÌÑ∞ ${position}`;

            hiddenMonitors.push({
                position: position,
                matrix_id: matrixId,
                name: name
            });
        });

        const $hiddenContainer = $('#hiddenMonitors');

        if (hiddenMonitors.length === 0) {
            $hiddenContainer.html('<small class="text-muted">Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</small>');
        } else {
            let html = '';
            hiddenMonitors.forEach(monitor => {
                html += `
                <div class="hidden-monitor-item mb-2 p-2 border rounded">
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">${monitor.name}</small>
                        <button class="btn btn-sm btn-outline-primary restore-monitor"
                                data-position="${monitor.position}"
                                data-matrix-id="${monitor.matrix_id}"
                                title="Îã§Ïãú Î≥¥Ïù¥Í∏∞">
                            <i class="fas fa-eye"></i>
                        </button>
                    </div>
                </div>
                `;
            });
            $hiddenContainer.html(html);
        }
    }

    // Ïà®Í≤®ÏßÑ Î™®ÎãàÌÑ∞ Î≥µÏõê
    $(document).on('click', '.restore-monitor', function(e) {
        e.preventDefault();
        const position = $(this).data('position');
        const matrixId = $(this).data('matrix-id');

        const $monitor = $(`.monitor-item[data-position="${position}"][data-matrix="${matrixId}"]`);
        $monitor.removeClass('hidden');
        $monitor.find('.btn-toggle-visibility i').removeClass('fa-eye-slash').addClass('fa-eye');
        $monitor.find('.btn-toggle-visibility').attr('title', 'Ïà®Í∏∞Í∏∞');

        updateHiddenMonitorsList();
        showSuccessToast('Î™®ÎãàÌÑ∞Í∞Ä Î≥µÏõêÎêòÏóàÏäµÎãàÎã§.');
    });

    // ÌÜ†Ïä§Ìä∏ ÏïåÎ¶º Ìï®ÏàòÎì§
    function showSuccessToast(message) {
        showToast(message, 'success');
    }

    function showErrorToast(message) {
        showToast(message, 'error');
    }

    function showToast(message, type) {
        const bgColor = type === 'success' ? '#28a745' : '#dc3545';

        $('.toast-notification').remove();

        const toast = $(`
        <div class="toast-notification" style="
            position: fixed;
            bottom: 100px;
            right: 20px;
            background: ${bgColor};
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-weight: 500;
            z-index: 9999;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            animation: slideInRight 0.3s ease;
        ">
            <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
            ${message}
        </div>
        `);

        $('body').append(toast);

        setTimeout(() => {
            toast.fadeOut(300, () => toast.remove());
        }, 3000);
    }

    function showEditingToast() {
        $('.editing-toast').remove();

        const toast = $(`
        <div class="editing-toast" style="
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-weight: 500;
            z-index: 9999;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
            animation: slideDown 0.5s ease;
        ">
            <i class="fas fa-info-circle"></i>
            Ìé∏Ïßë Î™®ÎìúÏûÖÎãàÎã§. Î™®ÎãàÌÑ∞Î•º ÎìúÎûòÍ∑∏ÌïòÍ±∞ÎÇò Îàà Î≤ÑÌäºÏúºÎ°ú Ïà®Í∏∏ Ïàò ÏûàÏäµÎãàÎã§
        </div>
        `);

        $('body').append(toast);

        setTimeout(() => {
            toast.fadeOut(500, () => toast.remove());
        }, 3000);
    }

    $(document).on('click', '.btn-edit-names', function() {
    const position = $(this).data('position');
    const matrixId = $(this).data('matrix');

    // ÌòÑÏû¨ Ïù¥Î¶ÑÎì§ Í∞ÄÏ†∏Ïò§Í∏∞
    const $monitorItem = $(`.monitor-item[data-position="${position}"][data-matrix="${matrixId}"]`);

    // Î™®ÎãàÌÑ∞ Ïù¥Î¶Ñ - .monitor-labelÏóêÏÑú Í∞ÄÏ†∏Ïò§Í∏∞ (Î©îÏù∏ Îß§Ìä∏Î¶≠Ïä§Ïö©)
    let currentMonitorName = $monitorItem.find('.monitor-label').text().trim();

    // ÏÑúÎ∏å Îß§Ìä∏Î¶≠Ïä§Ïùò Í≤ΩÏö∞ KVM Î≤ÑÌäºÏóêÏÑú Î™®ÎãàÌÑ∞ Ïù¥Î¶Ñ Í∞ÄÏ†∏Ïò§Í∏∞
    if (!currentMonitorName) {
        currentMonitorName = $monitorItem.find('button[name="kvm_button"]').text().trim();
    }

    // select ÏòµÏÖòÏóêÏÑú ÌòÑÏû¨ ÏÑ†ÌÉùÎêú ÎîîÎ∞îÏù¥Ïä§ Ïù¥Î¶Ñ Í∞ÄÏ†∏Ïò§Í∏∞
    const $select = $monitorItem.find('select[name="input_select"]');
    let currentDeviceName = $select.find('option:selected').text().trim();

    // Î™®Îã¨ Ìèº ÏÑ§Ï†ï - Í∏∞Ï°¥ Ïù¥Î¶ÑÎì§ÏùÑ ÏûÖÎ†•Ï∞ΩÏóê ÎØ∏Î¶¨ Ï±ÑÏõåÎÑ£Í∏∞
    $('#modal-position').val(position);
    $('#modal-matrix-id').val(matrixId);

    // value ÏÜçÏÑ± ÎåÄÏã† val() Î©îÏÑúÎìú ÏÇ¨Ïö©ÌïòÏó¨ ÏûÖÎ†•Ï∞ΩÏóê Í∏∞Ï°¥ Í∞í ÏÑ§Ï†ï
    $('#modal-monitor-name').val(currentMonitorName);
    $('#modal-device-name').val(currentDeviceName);

    // Ìèº action URL ÏÑ§Ï†ï
    const actionUrl = `/api/matrix/${matrixId}/update-names/`;
    $('#updateNamesForm').attr('action', actionUrl);
});

// Ìèº Ï†úÏ∂ú ÌõÑ Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏
$('#updateNamesForm').on('submit', function(e) {
    e.preventDefault();

    const formData = new FormData(this);
    const actionUrl = $(this).attr('action');

    $.ajax({
        url: actionUrl,
        type: 'POST',
        data: formData,
        processData: false,
        contentType: false,
        success: function(response) {
            if (response.success) {
                // ÏÑ±Í≥µ Ïãú ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
                const position = $('#modal-position').val();
                const matrixId = $('#modal-matrix-id').val();
                const monitorName = $('#modal-monitor-name').val();
                const deviceName = $('#modal-device-name').val();

                // Î™®ÎãàÌÑ∞ ÎùºÎ≤® ÏóÖÎç∞Ïù¥Ìä∏
                const $monitorItem = $(`.monitor-item[data-position="${position}"][data-matrix="${matrixId}"]`);
                $monitorItem.find('.monitor-label').text(monitorName);

                // KVM Î≤ÑÌäº ÌÖçÏä§Ìä∏ÎèÑ ÏóÖÎç∞Ïù¥Ìä∏ (ÏÑúÎ∏å Îß§Ìä∏Î¶≠Ïä§Ïö©)
                $monitorItem.find('button[name="kvm_button"]').text(monitorName);

                // Î™®Îã¨ Îã´Í∏∞
                $('#updateNamesModal').modal('hide');

                // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
                showSuccessToast('Ïù¥Î¶ÑÏù¥ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÏóàÏäµÎãàÎã§.');

                // ÌéòÏù¥ÏßÄ ÏÉàÎ°úÍ≥†Ïπ®ÏúºÎ°ú Î≥ÄÍ≤ΩÏÇ¨Ìï≠ Î∞òÏòÅ
                setTimeout(() => {
                    location.reload();
                }, 1000);
            } else {
                alert('Ïò§Î•ò: ' + response.message);
            }
        },
        error: function(xhr, status, error) {
            console.error('Error:', error);
            alert('Ïù¥Î¶Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§.');
        }
    });
});

// ÏÑ±Í≥µ ÌÜ†Ïä§Ìä∏ Î©îÏãúÏßÄ Ìï®Ïàò (Í∏∞Ï°¥Ïóê ÏûàÎã§Î©¥ ÏÇ¨Ïö©, ÏóÜÎã§Î©¥ Ï∂îÍ∞Ä)
function showSuccessToast(message) {
    // Í∞ÑÎã®Ìïú ÏïåÎ¶º (ÌÜ†Ïä§Ìä∏Í∞Ä Íµ¨ÌòÑÎêòÏñ¥ ÏûàÏßÄ ÏïäÏùÄ Í≤ΩÏö∞)
    const toast = $(`
        <div class="toast-container position-fixed top-0 end-0 p-3">
            <div class="toast show" role="alert">
                <div class="toast-header">
                    <strong class="me-auto">ÏïåÎ¶º</strong>
                    <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
                </div>
                <div class="toast-body">
                    ${message}
                </div>
            </div>
        </div>
    `);

    $('body').append(toast);

    setTimeout(() => {
        toast.remove();
    }, 3000);
}


</script>
{% endblock javascript %}